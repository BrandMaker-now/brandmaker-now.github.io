<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイピング練習</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #news-text { border: 1px solid #ccc; padding: 15px; min-height: 150px; white-space: pre-wrap; margin-bottom: 10px; background-color: #f9f9f9; }
        #typing-area { width: 100%; height: 150px; padding: 15px; box-sizing: border-box; font-size: 16px; resize: none; }
        #timer, #result { font-size: 24px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <a href="index.html">← メニューに戻る</a>
    <h1>タイピング練習（ニュース）</h1>
    
    <p>ニュース記事を読み込み中...</p>
    <div id="news-text"></div>
    
    <textarea id="typing-area" placeholder="ここにニュース記事をタイピングしてください..." oninput="checkTyping()" disabled></textarea>

    <div id="timer">残り時間: 60秒</div>
    <div id="result"></div>

    <script>
        // !!重要!! News APIなどで無料のAPIキーを取得し、ここに入力してください。
        // 無料APIはCORS制限がある場合が多く、GitHub Pagesでは動かない可能性があります。
        const API_KEY = "YOUR_NEWS_API_KEY"; 
        
        const newsTextElement = document.getElementById('news-text');
        const typingArea = document.getElementById('typing-area');
        const timerElement = document.getElementById('timer');
        const resultElement = document.getElementById('result');
        let articleContent = "";
        let timerInterval;
        let timeLeft = 60;

        async function fetchNews() {
            // CORS制限回避のためのプロキシを使用する例。うまくいかない場合はテキスト直書きに
            const proxy = 'https://corsproxy.io?'; 
            const url = `${proxy}https://newsapi.org{API_KEY}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.articles && data.articles.length > 0) {
                    // contentがない場合descriptionを使う
                    articleContent = data.articles[0].content || data.articles[0].description || "記事本文がありません。";
                    newsTextElement.innerText = articleContent;
                    typingArea.disabled = false;
                    typingArea.focus();
                    startTimer();
                } else {
                    newsTextElement.innerText = "ニュース記事を取得できませんでした。";
                }
            } catch (error) {
                console.error(error);
                newsTextElement.innerText = "エラー: ニュースAPIに接続できませんでした。APIキーまたはCORS設定を確認してください。";
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.innerText = `残り時間: ${timeLeft}秒`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function checkTyping() {
            const typedText = typingArea.value;
            // 記事の最後まで打ったら終了
            if (typedText === articleContent) {
                clearInterval(timerInterval);
                endGame();
            }
        }

        function endGame() {
            typingArea.disabled = true;
            timerElement.innerText = "終了！";
            const typedChars = typingArea.value.length;
            const wpm = (typedChars / 60) * (60 - timeLeft); // 速度計算
            resultElement.innerText = `スコア: ${typedChars}文字 | 速度: 約${wpm.toFixed(0)}文字/分`;
        }

        fetchNews();
    </script>
</body>
</html>
