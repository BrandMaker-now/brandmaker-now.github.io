<script>
    const wordDisplay = document.getElementById('word');
    const inputField = document.getElementById('input-field');
    let newsItems = [];
    let currentIndex = 0;

    async function init() {
        try {
            const res = await fetch('./news.txt?t=' + Date.now());
            if (!res.ok) throw new Error();
            const text = await res.text();
            
            // 空白を除去して配列にする
            newsItems = text.trim().split('\n').filter(i => i.trim().length > 0);
            
            // もし中身が空だったら
            if (newsItems.length === 0) {
                wordDisplay.textContent = "ニュースを更新中です。少々お待ちください。";
            } else {
                updateDisplay();
            }
        } catch (e) {
            wordDisplay.textContent = "ニュースファイルが見つかりません。Actionsを実行してください。";
        }
    }

    function updateDisplay() {
        if (currentIndex < newsItems.length) {
            wordDisplay.textContent = newsItems[currentIndex];
            inputField.value = '';
        } else {
            wordDisplay.textContent = "✨ すべて完了！ ✨";
            inputField.disabled = true;
        }
    }

    inputField.addEventListener('input', () => {
        if (inputField.value === newsItems[currentIndex]) {
            currentIndex++;
            updateDisplay();
        }
    });

    init();
</script>
